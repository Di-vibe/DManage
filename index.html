<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dmange</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --bg: #f5f6fa;
            --surface: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --success: #00b894;
            --danger: #d63031;
            --shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 80px; /* Space for FAB */
        }

        /* --- Header --- */
        header {
            padding: 20px 20px 0 20px;
        }
        
        h1 { margin: 0; font-size: 1.5rem; font-weight: 800; color: var(--text-main); }
        p.subtitle { margin: 5px 0 0 0; color: var(--text-sub); font-size: 0.9rem; }

        /* --- Modern Summary Card --- */
        .summary-card {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            margin: 20px;
            padding: 25px;
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(108, 92, 231, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .summary-card .label { font-size: 0.85rem; opacity: 0.9; margin-bottom: 5px; }
        .summary-card .balance { font-size: 2.5rem; font-weight: 700; margin: 0; }

        .stats-row {
            display: flex;
            width: 100%;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .stat-item { flex: 1; text-align: center; }
        .stat-item h4 { margin: 0; font-size: 1.1rem; font-weight: 600; }
        .stat-item span { font-size: 0.8rem; opacity: 0.8; }

        /* --- Transaction List --- */
        .section-title {
            margin: 0 20px 15px 20px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .tx-list {
            list-style: none;
            padding: 0 20px;
            margin: 0;
        }

        .tx-item {
            background: var(--surface);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: transform 0.1s;
        }

        .tx-item:active { transform: scale(0.98); }

        .tx-left { display: flex; align-items: center; gap: 15px; }
        
        .tx-icon {
            width: 45px; height: 45px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        .icon-income { background: #e6fcf5; color: var(--success); }
        .icon-expense { background: #fff0f1; color: var(--danger); }

        .tx-details h4 { margin: 0; font-size: 1rem; font-weight: 600; }
        .tx-details p { margin: 4px 0 0 0; font-size: 0.8rem; color: var(--text-sub); }

        .tx-amount { font-weight: 700; font-size: 1rem; }
        .pos { color: var(--success); }
        .neg { color: var(--danger); }

        /* --- Floating Action Button (FAB) --- */
        .fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background: var(--text-main);
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 100;
            border: none;
        }

        /* --- Bottom Sheet Modal --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(3px);
            z-index: 200;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sheet {
            position: fixed; bottom: -100%; left: 0; width: 100%;
            background: var(--surface);
            border-radius: 24px 24px 0 0;
            padding: 30px 25px 40px 25px;
            z-index: 201;
            transition: bottom 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-sizing: border-box;
        }

        .sheet-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px;
        }
        .sheet-header h2 { margin: 0; font-size: 1.3rem; }

        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        
        .toggle-group {
            display: flex; background: var(--bg);
            padding: 4px; border-radius: 12px;
        }
        .toggle-opt {
            flex: 1; padding: 12px; text-align: center;
            border-radius: 10px; font-weight: 600; font-size: 0.9rem;
            cursor: pointer; transition: 0.2s;
        }
        .toggle-opt.selected.income { background: white; color: var(--success); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .toggle-opt.selected.expense { background: white; color: var(--danger); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        input {
            width: 100%; padding: 15px;
            border: 2px solid var(--bg); background: var(--bg);
            border-radius: 12px; font-size: 1rem; outline: none;
            transition: 0.2s;
        }
        input:focus { border-color: var(--primary); background: white; }

        /* Date/Time Row */
        .row-inputs {
            display: flex;
            gap: 15px;
        }
        .row-inputs input { flex: 1; }

        .btn-full {
            width: 100%; padding: 16px;
            border-radius: 14px; border: none;
            font-size: 1rem; font-weight: 700; cursor: pointer;
            margin-top: 10px;
        }
        .btn-save { background: var(--primary); color: white; }
        .btn-delete { background: #fff0f1; color: var(--danger); margin-top: 15px; }
        
    </style>
</head>
<body>

    <header>
        <p class="subtitle">Welcome back</p>
        <h1>DMange</h1>
    </header>

    <!-- Financial Summary -->
    <div class="summary-card">
        <span class="label">Total Balance</span>
        <h2 class="balance" id="display-balance">0.00</h2>
        <div class="stats-row">
            <div class="stat-item">
                <span>Income</span>
                <h4 id="display-income">0.00</h4>
            </div>
            <div class="stat-item">
                <span>Expenses</span>
                <h4 id="display-expense">0.00</h4>
            </div>
        </div>
    </div>

    <!-- Transaction List -->
    <div class="section-title">Recent Transactions</div>
    <ul class="tx-list" id="tx-list">
        <!-- Javascript fills this -->
    </ul>
    
    <div id="empty-state" style="text-align: center; color: #b2bec3; margin-top: 50px; display: none;">
        <p>No transactions yet.</p>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="openSheet()">+</button>

    <!-- Bottom Sheet Modal (Add/Edit) -->
    <div class="overlay" id="overlay" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet">
        <div class="sheet-header">
            <h2 id="sheet-title">New Transaction</h2>
            <span onclick="closeSheet()" style="font-size: 1.5rem; color: #b2bec3; cursor:pointer;">&times;</span>
        </div>

        <input type="hidden" id="tx-id">

        <div class="form-group">
            <div class="toggle-group">
                <div class="toggle-opt selected income" id="opt-income" onclick="setType('income')">Income</div>
                <div class="toggle-opt" id="opt-expense" onclick="setType('expense')">Expense</div>
            </div>
        </div>

        <div class="form-group">
            <input type="number" id="inp-amount" placeholder="Amount (e.g. 50.00)" inputmode="decimal">
        </div>

        <div class="form-group">
            <input type="text" id="inp-desc" placeholder="Description (e.g. Food, Salary)">
        </div>

        <!-- Date & Time Row -->
        <div class="form-group row-inputs">
            <input type="date" id="inp-date" aria-label="Date">
            <input type="time" id="inp-time" aria-label="Time">
        </div>

        <button class="btn-full btn-save" onclick="saveTransaction()">Save</button>
        <button class="btn-full btn-delete" id="btn-delete" style="display:none;" onclick="deleteTransaction()">Delete</button>
    </div>

<script>
    // --- Data Management ---
    let transactions = JSON.parse(localStorage.getItem('d_accounting_db')) || [];
    let currentType = 'income';

    // Initialize UI
    updateUI();

    // --- UI Functions ---
    function openSheet(isEdit = false, id = null) {
        const overlay = document.getElementById('overlay');
        const sheet = document.getElementById('sheet');
        const deleteBtn = document.getElementById('btn-delete');
        
        overlay.style.display = 'block';
        setTimeout(() => overlay.style.opacity = '1', 10);
        sheet.style.bottom = '0';

        // --- Auto Set Date & Time Logic ---
        const now = new Date();
        // 1. Format Date: YYYY-MM-DD (Local Time)
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const dateStr = `${year}-${month}-${day}`;

        // 2. Format Time: HH:MM (Local Time)
        const hours = String(now.getHours()).padStart(2, '0');
        const mins = String(now.getMinutes()).padStart(2, '0');
        const timeStr = `${hours}:${mins}`;

        if(isEdit) {
            document.getElementById('sheet-title').innerText = "Edit";
            deleteBtn.style.display = 'block';
            
            // Fill Form with Existing Data
            const tx = transactions.find(t => t.id === id);
            document.getElementById('tx-id').value = tx.id;
            document.getElementById('inp-amount').value = tx.amount;
            document.getElementById('inp-desc').value = tx.desc;
            
            // Use saved date/time
            document.getElementById('inp-date').value = tx.date;
            document.getElementById('inp-time').value = tx.time || "12:00";
            
            setType(tx.type);
        } else {
            // NEW TRANSACTION: AUTO FILL NOW
            document.getElementById('sheet-title').innerText = "New";
            deleteBtn.style.display = 'none';
            
            // Reset Fields
            document.getElementById('tx-id').value = '';
            document.getElementById('inp-amount').value = '';
            document.getElementById('inp-desc').value = '';
            
            // Set Auto Date/Time
            document.getElementById('inp-date').value = dateStr;
            document.getElementById('inp-time').value = timeStr;
            
            setType('income');
            
            // Auto-focus amount for speed
            setTimeout(() => document.getElementById('inp-amount').focus(), 400);
        }
    }

    function closeSheet() {
        const overlay = document.getElementById('overlay');
        const sheet = document.getElementById('sheet');
        
        overlay.style.opacity = '0';
        sheet.style.bottom = '-100%';
        setTimeout(() => overlay.style.display = 'none', 300);
    }

    function setType(type) {
        currentType = type;
        const inc = document.getElementById('opt-income');
        const exp = document.getElementById('opt-expense');
        
        if(type === 'income') {
            inc.classList.add('selected', 'income');
            exp.classList.remove('selected', 'expense');
        } else {
            exp.classList.add('selected', 'expense');
            inc.classList.remove('selected', 'income');
        }
    }

    // --- Logic ---
    function saveTransaction() {
        const idStr = document.getElementById('tx-id').value;
        const amount = parseFloat(document.getElementById('inp-amount').value);
        const desc = document.getElementById('inp-desc').value;
        const date = document.getElementById('inp-date').value;
        const time = document.getElementById('inp-time').value;

        if(!desc || isNaN(amount) || amount <= 0) {
            alert("Please enter a valid amount and description");
            return;
        }

        const txObj = {
            id: idStr ? parseInt(idStr) : Date.now(),
            type: currentType,
            amount: amount,
            desc: desc,
            date: date,
            time: time
        };

        if(idStr) {
            // Update Existing
            const index = transactions.findIndex(t => t.id == idStr);
            if(index > -1) transactions[index] = txObj;
        } else {
            // Create New
            transactions.push(txObj);
        }

        saveAndRender();
        closeSheet();
    }

    function deleteTransaction() {
        if(confirm("Delete this transaction?")) {
            const id = document.getElementById('tx-id').value;
            transactions = transactions.filter(t => t.id != id);
            saveAndRender();
            closeSheet();
        }
    }

    function saveAndRender() {
        localStorage.setItem('d_accounting_db', JSON.stringify(transactions));
        updateUI();
    }

    function updateUI() {
        const list = document.getElementById('tx-list');
        list.innerHTML = '';
        
        let total = 0, inc = 0, exp = 0;

        // Sort by Date AND Time descending (Newest first)
        transactions.sort((a,b) => {
            const dateA = new Date(a.date + ' ' + (a.time || '00:00'));
            const dateB = new Date(b.date + ' ' + (b.time || '00:00'));
            return dateB - dateA;
        });

        if(transactions.length === 0) {
            document.getElementById('empty-state').style.display = 'block';
        } else {
            document.getElementById('empty-state').style.display = 'none';
        }

        transactions.forEach(t => {
            if(t.type === 'income') { inc += t.amount; }
            else { exp += t.amount; }

            const li = document.createElement('li');
            li.className = 'tx-item';
            li.onclick = () => openSheet(true, t.id); // Click to edit

            const icon = t.type === 'income' ? '↓' : '↑';
            const iconClass = t.type === 'income' ? 'icon-income' : 'icon-expense';
            const amtClass = t.type === 'income' ? 'pos' : 'neg';
            const sign = t.type === 'income' ? '+' : '-';
            
            // Format Time display
            const displayTime = t.time ? ` • ${t.time}` : '';

            li.innerHTML = `
                <div class="tx-left">
                    <div class="tx-icon ${iconClass}">${icon}</div>
                    <div class="tx-details">
                        <h4>${t.desc}</h4>
                        <p>${t.date}${displayTime}</p>
                    </div>
                </div>
                <div class="tx-amount ${amtClass}">${sign}${t.amount.toFixed(2)}</div>
            `;
            list.appendChild(li);
        });

        total = inc - exp;

        // Update Summary (Pure numbers, no $)
        document.getElementById('display-balance').innerText = `${total.toFixed(2)}`;
        document.getElementById('display-income').innerText = `+${inc.toFixed(2)}`;
        document.getElementById('display-expense').innerText = `-${exp.toFixed(2)}`;
    }
</script>

</body>
</html>
